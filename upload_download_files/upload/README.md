### ä¸€ã€æ–‡ä»¶å¤¹è¯´æ˜
ä»£ç æœ‰å‰ç«¯çš„ä»£ç å’Œåç«¯çš„ä»£ç ï¼Œå…¶ä¸­ `file_chunk` æ–‡ä»¶å¤¹ä¸‹çš„æ˜¯å‰ç«¯çš„ä»£ç ï¼Œè€Œ `fragment` æ–‡ä»¶å¤¹ä¸‹çš„æ˜¯åç«¯çš„ä»£ç ã€‚

### äºŒã€é¡¹ç›®ä¸»è¦ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€ï¼š

- **å‰ç«¯**ï¼šä½¿ç”¨åŸç”Ÿçš„ JavaScript å¼€å‘ï¼Œå‘é€è¯·æ±‚ä½¿ç”¨çš„æ˜¯ XMLHttpRequestï¼Œä½¿ç”¨äº† Sass ç®€åŒ–äº† CSS çš„ç¼–å†™ã€‚
- **åç«¯**ï¼šä½¿ç”¨ Java å¼€å‘ï¼Œç®€å•ä½¿ç”¨äº† SpringBoot å¼€å‘åç«¯ï¼Œåªæ˜¯æ¥æ”¶è¯·æ±‚ï¼Œå¤„ç†æ–‡ä»¶ã€‚ä½¿ç”¨äº† Hutool æä¾›çš„ MD5 ç¼–ç æ–‡ä»¶ã€‚

### ä¸‰ã€å®ç°ç»“æœ
è¦æŸ¥çœ‹å…·ä½“çš„å®ç°ç»“æœè¯·ç§»æ­¥åˆ°ç›¸åº”çš„æ–‡ä»¶å¤¹ä¸‹ã€‚

#### 3.1. é¡¹ç›®ç‰ˆæœ¬è¿­ä»£

##### 3.1.1. FileUpload V1.0.0

æ—¶é—´ï¼š2023å¹´ 12æœˆ 03æ—¥ã€‚

- å®ç°åŠŸèƒ½ï¼š
  - å®ç°æ–‡ä»¶çš„åˆ†ç‰‡ä¸Šä¼ ã€æ–­ç‚¹ç»­ä¼ ã€‚
  - å®ç°æœåŠ¡ç«¯åˆ†ç‰‡åˆå¹¶ã€‚

##### 3.1.2. FileUpload V2.0.0

æ—¶é—´ï¼š2024å¹´ 03æœˆ 25æ—¥ã€‚

- é‡æ„åç«¯ä»£ç 
  - åŸå› ï¼šä¹‹å‰æœªèƒ½å®ç°å¹¶å‘ä¸Šä¼ ï¼Œä¸€æ¬¡åªèƒ½ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸Šä¼ åæœåŠ¡ç«¯éœ€è¦é‡å¯æ‰èƒ½æ¸…é™¤ä¹‹å‰çš„ â€œæ–‡ä»¶æ®‹ä½™â€ã€‚
- å®ç°åŠŸèƒ½ï¼š
  - å®ç°æ–‡ä»¶å¹¶å‘ä¸Šä¼ ã€‚
  - å®ç°æ–‡ä»¶åç¼€æ£€æŸ¥ï¼Œé˜»æ­¢ä¸Šä¼  `.exe` æ–‡ä»¶ã€‚


### å››ã€é¡¹ç›®è§£é‡Š


#### ä¸€ã€å‰è¨€
æ–‡ä»¶ä¸Šä¼ æ˜¯ä¸€ä¸ªéå¸¸çƒ­çš„é¢†åŸŸï¼Œä¸ä¹‹å¯¹åº”çš„æ˜¯æ–‡ä»¶ä¸‹è½½ï¼Œç›®å‰åªå®ç°äº†æ–‡ä»¶çš„ä¸Šä¼ ï¼Œè¿˜æœªå®ç°æ–‡ä»¶çš„ä¸‹è½½ï¼Œä¸ä¸Šä¼ ç›¸æ¯”ï¼Œæ–‡ä»¶çš„ä¸‹è½½æ›´åŠ å¤æ‚ã€‚

å…ˆç®€å•è¯´ä¸€ä¸‹å‡ ä¸ªå…³äºæ–‡ä»¶ä¼ è¾“çš„åè¯ï¼š

- æ–‡ä»¶åˆ†ç‰‡ï¼ˆåˆ†å—ï¼‰ï¼šå°†ä¸€ä¸ªæ–‡ä»¶åˆ†å‰²æˆè®¸å¤šå°`åˆ†ç‰‡`ï¼Œç„¶åå°†è¿™äº›å°åˆ†ç‰‡å‘é€åˆ°æœåŠ¡å™¨ã€‚æ–‡ä»¶åˆ†ç‰‡çš„ç›®çš„æ˜¯å°†ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ è¯·æ±‚åˆ’åˆ†ä¸ºå¤šä¸ªè¯·æ±‚ï¼Œä½¿ç”¨å¤šçº¿ç¨‹ä¸Šä¼ æ–‡ä»¶ï¼Œæé«˜ä¸Šä¼ çš„æ•ˆç‡ã€‚

![file-chunk.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/903fabb9ddd34cfdb7c2ee28264c8bad~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=646&h=495&s=39005&e=png&a=1&b=f6f6f6)

- æ–­ç‚¹ç»­ä¼ ï¼šæ–­ç‚¹ç»­ä¼ æ˜¯åœ¨æ–‡ä»¶åˆ†ç‰‡çš„åŸºç¡€ä¸Šå®ç°çš„ã€‚æ–­ç‚¹ç»­ä¼ çš„ä½œç”¨æ˜¯æå¤§ç¨‹åº¦çš„é¿å…äº†ç”±äºç”¨æˆ·ç½‘ç»œä¸ç¨³å®šçš„é—®é¢˜ï¼Œä»¥åŠå…¶ä»–åŸå› å¯¼è‡´çš„æ–‡ä»¶ä¸Šä¼ çš„è¯·æ±‚çš„ä¸­æ–­ï¼Œä½¿å¾—æ–‡ä»¶ä¸Šä¼ çš„å¤±è´¥ï¼Œæ²¡æœ‰æ–­ç‚¹ç»­ä¼ å°±éœ€è¦é‡æ–°ä¸Šä¼ ï¼Œå¦‚æœæ˜¯ä¸€ä¸ª G çš„æ–‡ä»¶çš„é‡æ–°ä¸Šä¼ ï¼Œè¿™å¯¹äºä»»ä½•äººæ¥è¯´éƒ½æ˜¯æ— æ³•å¿å—çš„ã€‚æ–­ç‚¹ç»­ä¼ å¯ä»¥å®ç°æ–‡ä»¶ä¸Šä¼ çš„æš‚åœã€‚


![abort.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f13bc0aa271147568c559f2342f3c531~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=902&h=216&s=31354&e=png&a=1&b=37393a)

- æ–‡ä»¶ç§’ä¼ ï¼šæ–‡ä»¶ç§’ä¼ æ˜¯ç”¨æˆ·åœ¨ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œå¦‚æœåœ¨æœåŠ¡å™¨ä¸Šæ‰¾å¾—åˆ°ç›¸åŒçš„æ–‡ä»¶ï¼Œå°±å°†è¿™ä¸ªæ–‡ä»¶çš„ uri ç»™åˆ°å®¢æˆ·ç«¯ï¼Œçœå»äº†ä¸Šä¼ çš„è¿‡ç¨‹ã€‚æ–‡ä»¶ä¸Šä¼ çš„å®ç°ï¼Œåœ¨æ–‡ä»¶æ¯”è¾ƒå°‘æ—¶ä»¥åŠæ–‡ä»¶å¤§å°ä¸å¤§æ—¶æ¯”è¾ƒå¯é ï¼Œå› ä¸ºå®ƒçš„å®ç°éœ€è¦æ¯”è¾ƒå¤§çš„ç®—åŠ›ï¼Œå½“æ–‡ä»¶ç‰¹åˆ«å¤§æ—¶ï¼Œæ— è®ºæ˜¯åœ¨å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯éƒ½æ˜¯éå¸¸æ¶ˆè€—ç®—åŠ›èµ„æºçš„ï¼ˆå› ä¸ºè¦è®¡ç®—æ–‡ä»¶æ•°æ®çš„ hash å€¼ï¼Œhash å€¼ä¸€èˆ¬æ˜¯å”¯ä¸€çš„ï¼Œéš¾ä»¥é‡å¤ï¼‰ã€‚


![exist.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1d8fa1f1001a4f5eb2c4d2ad658934c2~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=887&h=231&s=32724&e=png&a=1&b=383a3b)

#### äºŒã€ä¸»è¦ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€
ä¸»è¦ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€ï¼š

- **å‰ç«¯**ï¼šåŸç”Ÿ JavaScriptï¼ˆå‘é€è¯·æ±‚ä½¿ç”¨çš„æ˜¯ XMLHttpRequestï¼Œè¿™é‡Œæˆ‘å¯¹å®ƒè¿›è¡Œäº†ç®€å•å°è£…ï¼‰ï¼Œä½¿ç”¨äº† Sass ç®€åŒ– CSS ç¼–å†™ã€‚

- **åç«¯**ï¼šä½¿ç”¨ Java å¼€å‘ï¼Œç²—ç•¥ä½¿ç”¨äº† SpringBootï¼ˆåªæ˜¯å¤„ç†è¯·æ±‚ï¼‰ï¼Œä½¿ç”¨äº† Hutool è¿›è¡Œäº† MD5 ç¼–ç ã€‚

ä¸ºä»€ä¹ˆä½¿ç”¨ Java å¼€å‘åç«¯ï¼Ÿå› ä¸ºæ²¡å­¦ node.jsï¼Œä¸ä¼š...ğŸ˜…

### ä¸‰ã€å®ç°ç»“æœ
ç”±äºå®ç°çš„ç»“æœå¯èƒ½ä¸å¤§å®¶æƒ³è±¡çš„ä¸ä¸€æ ·ï¼Œæ‰€ä»¥è¿™é‡Œå…ˆç»™å¤§å®¶è¯´ä¸€ä¸‹å®ç°çš„ç»“æœå¦‚ä½•ã€‚

ä¸Šä¼ é¡µé¢å±•ç¤ºï¼ˆé¡µé¢ä¸‘é™‹è¿˜è¯·è§è°…ğŸ˜…ï¼‰ï¼š

![åŠ¨ç”».gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a44c03aad1424dea94ae2124da8922b6~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=619&h=494&s=60080&e=gif&f=41&b=ffffff)

**å·²å®ç°**ï¼š

- **å®ç°æ–‡ä»¶åˆ†å—ä¸Šä¼ **ï¼šæ ¹æ®æŒ‡å®šçš„åˆ†å—å¤§å°æ¥ä¸Šä¼ æ–‡ä»¶ï¼Œæ¯ä¸ªåˆ†å—åˆ†åˆ«ä½œä¸ºä¸€ä¸ª`å•ç‹¬çš„è¯·æ±‚`å‘é€ï¼ŒæœåŠ¡å™¨åˆ™ä¼šä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹æ¥æ”¶ã€‚ç”±äºåˆ†å—å¿…ç„¶éœ€è¦åˆ†å—æ–‡ä»¶çš„åˆå¹¶ï¼Œæ‰€ä»¥æœåŠ¡ç«¯éœ€è¦å®ç°æ–‡ä»¶çš„åˆå¹¶ã€‚

- **å®ç°æ–‡ä»¶æ–­ç‚¹ç»­ä¼ **ï¼šåŸºäºæ–‡ä»¶åˆ†å—ï¼Œå¯ä»¥å®ç°`ä¸Šä¼ çš„æš‚åœ`ï¼Œå³ä¸­æ–­æ­£åœ¨ä¸Šä¼ çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¼š`ä¿å­˜å·²ç»ä¸Šä¼ çš„åˆ†å—`ï¼Œå¯ä»¥è®°å½•è¿™äº›åˆ†å—çš„ hash å€¼ï¼Œç„¶åå®¢æˆ·ç«¯ä¸‹æ¬¡ä¸Šä¼ æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå‘Šè¯‰å®¢æˆ·ç«¯è¿˜æœ‰å“ªäº›åˆ†å—æœªä¸Šä¼ ï¼ˆæˆ–è€…å“ªäº›åˆ†å—å·²ä¸Šä¼ ï¼‰ï¼Œå®¢æˆ·ç«¯åªè¦`ä¸Šä¼ æœªä¸Šä¼ çš„åˆ†å—`å°±å¯ä»¥äº†ï¼Œä¸ç”¨ä»å¤´å¼€å§‹ä¸Šä¼ ã€‚

- **å®ç°è¯·æ±‚é˜Ÿåˆ—**ï¼šç”±äºæ–‡ä»¶åˆ†ç‰‡åä¼šç”Ÿæˆéå¸¸å¤šçš„å°åˆ†å—ï¼Œå¦‚æœåŒæ—¶å°†è¿™äº›åˆ†å—å‘é€åˆ°æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½ä¼šæ‰¿å—å·¨å¤§çš„å‹åŠ›ã€‚è¿™é‡Œæ€æƒ³ä¸â€œé™æµâ€ç±»ä¼¼ï¼Œå°±æ˜¯`é™åˆ¶è¯·æ±‚`ã€‚

- **å®ç°ä¸Šä¼ è¿›åº¦å±•ç¤º**ï¼šç”±äºä¸Šä¼ çš„æ˜¯æ–‡ä»¶çš„åˆ†ç‰‡ï¼Œæ‰€ä»¥éœ€è¦å°†è¿›åº¦ä»¥æŸç§è®¡ç®—æ–¹å¼ç´¯åŠ ï¼Œè¿›è€Œè®¡ç®—æ€»è¿›åº¦ã€‚ç”±äºè¯·æ±‚å¯ä»¥è¢«ä¸­æ–­ï¼Œæ‰€ä»¥æœ‰äº›è¿›åº¦çš„å®ç°ä¼šå‡ºç°`è¿›åº¦æ¡çš„å›é€€`ç°è±¡ï¼Œæ¯”å¦‚å“”å“©å“”å“©æŠ•ç¨¿ä¸Šä¼ å°±æœ‰è¿™ä¸ªç°è±¡ã€‚

- **å…¶ä»–åŸºæœ¬å®ç°**ï¼šåˆ†å—ä¸Šä¼ çš„é…å¥—å®ç°è¦æ±‚æœ‰ï¼šåç«¯æ”¯æŒæ¥æ”¶æ–‡ä»¶åˆ†ç‰‡ã€åˆ†ç‰‡åˆå¹¶ã€‚

**æœªå®ç°**ï¼š

- **æœªå®ç°æ–‡ä»¶ç§’ä¼ **ï¼šè¿™ä¸ªæ²¡æœ‰å®ç°æ˜¯æœ‰åŸå› çš„ï¼Œå¼€å¤´ä»‹ç»å®ƒæ—¶è¯´è¿‡å®ç°å®ƒéœ€è¦è®¡ç®—ä¸Šä¼ çš„æ–‡ä»¶çš„ hashï¼Œç„¶ååœ¨æœåŠ¡å™¨ä¸Šéœ€è¦ä¿å­˜æ–‡ä»¶ï¼ˆä¸æ˜¯åˆ†å—çš„ hashï¼‰çš„ hashï¼ŒæœåŠ¡å™¨ä¸Šå¦‚æœæœ‰æ–‡ä»¶çš„ hash å€¼ä¸ä¸Šä¼ çš„æ–‡ä»¶çš„ hash å€¼ç›¸åŒï¼Œç›´æ¥è¿”å›æ–‡ä»¶çš„ URI å°±å¯ä»¥äº†ï¼Œè®©ç”¨æˆ·æ„Ÿè§‰ä¸Šä¼ äº†æ–‡ä»¶ä¸€æ ·ã€‚ä½†æ˜¯è®¡ç®— hash æ—¶æ¯”è¾ƒè€—æ—¶çš„ï¼Œå°±æš‚æ—¶æ”¾ä¸€æ”¾ğŸ˜‹ã€‚

- **æœªé™åˆ¶ä¸Šä¼ çš„æ–‡ä»¶çš„æ ¼å¼**ï¼šæ­£å¸¸æ¥è®²éœ€è¦æœåŠ¡ç«¯é™åˆ¶ä¸Šä¼ çš„æ–‡ä»¶æ ¼å¼ï¼Œæ¯”å¦‚åªèƒ½ä¸Šä¼ è§†é¢‘ï¼Œå°±é™åˆ¶ä¸Šä¼ çš„æ–‡ä»¶æ ¼å¼åªèƒ½æ˜¯ mp4ï¼Œæˆ–è€…å…¶ä»–è§†é¢‘æ ¼å¼ã€‚æ ¼å¼ä¸º exe çš„æ–‡ä»¶æ²¡æœ‰ç‰¹æ®Šè¦æ±‚æ˜¯ä¸€å®šä¸èƒ½ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ï¼Œè¿™ç§æ ¼å¼çš„æ–‡ä»¶å±é™©æ€§å¾ˆé«˜ã€‚

- **æœªå®ç°å¤šæ–‡ä»¶ä¸Šä¼ **ï¼šå¤šæ–‡ä»¶ä¸Šä¼ å¹¶æ²¡æœ‰è€ƒè™‘ï¼Œæ„Ÿè§‰å•æ–‡ä»¶èƒ½æˆåŠŸä¸Šä¼ ï¼Œå¤šæ–‡ä»¶ä¸Šä¼ åº”è¯¥æ˜¯ç±»ä¼¼çš„ã€‚åªè¦ä¸ºæ¯ä¸ªä¸Šä¼ çš„æ–‡ä»¶è®¾å®šä¸€ä¸ªå”¯ä¸€çš„ ID é˜²æ­¢å†²çªåº”è¯¥å°±è¡Œäº†ã€‚

- **æœªå®ç°æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ åçš„é‡è¯•**ï¼šå½“æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ å¤±è´¥åï¼Œæ²¡æœ‰å®ç°è¯·æ±‚å¤±è´¥é‡æ–°ä¸Šä¼ ã€‚è¿™ä¸ªå¦‚æœè¦åšçš„è¯ï¼Œä¸»è¦æ˜¯å‰ç«¯çš„ä½œä¸šï¼Œè¯·æ±‚å¤±è´¥æŠ¥é”™ï¼Œæ•è·é”™è¯¯åå†åˆ›å»ºä¸€ä¸ªè¯·æ±‚åŠ å…¥è¯·æ±‚é˜Ÿåˆ—åº”è¯¥å°±è¡Œäº†ã€‚

- **æœªå®ç°æ ¹æ®ç½‘ç»œçŠ¶å†µè°ƒèŠ‚åˆ†ç‰‡å¤§å°**ï¼šå½“ç”¨æˆ·ç½‘ç»œçŠ¶å†µè‰¯å¥½æ—¶ï¼Œå¯ä»¥å°†åˆ†ç‰‡çš„å¤§å°è®¾ç½®çš„å¤§ä¸€ç‚¹ï¼Œç½‘ç»œçŠ¶å†µè¾ƒå·®æ—¶å¯ä»¥å°†åˆ†ç‰‡çš„å¤§å°è®¾ç½®å°ä¸€ç‚¹ã€‚

- **æ›´å¤šçš„æƒ³æ³•**ï¼šå¦‚æœè¯»è€…ä»¬æœ‰æ›´å¤šå¥‡æ€å¦™æƒ³çš„æƒ³æ³•ï¼Œå¯ä»¥åœ¨è¯„è®ºåŒºç•™è¨€ï¼Œæˆ–è€…æ˜¯å–œæ¬¢åŠ¨æ‰‹çš„æœ‹å‹å¯ä»¥è‡ªå·±å†™ä¸€ä¸ªç±»ä¼¼çš„ä¸Šä¼ ç¨‹åºã€‚

PSï¼šä¸‹è½½æ–‡ä»¶å°±æ›´åŠ å¤æ‚äº†ï¼Œæˆ‘ä»¬å¹³æ—¶çœ‹çš„ç›´æ’­ï¼Œè§†é¢‘éƒ½æ˜¯æ–‡ä»¶çš„ä¸‹è½½ï¼Œè¿™ä¸ªéš¾åº¦é«˜ï¼Œä½¿ç”¨åˆ°çš„æ˜¯æµå¼ä¼ è¾“ï¼Œå°±æ˜¯è¾¹ä¸‹è½½è¾¹å¤„ç†ã€‚è¦ç¼–å†™ä¸‹è½½ç¨‹åºï¼Œé‚£å¾—äº†è§£ä¸€ä¸‹ HTTP åè®®æä¾›çš„æµå¼ä¼ è¾“åè®®ã€‚

#### å››ã€å®ç°æ€è·¯

ä¸‹é¢ç»™å‡ºæ–‡ä»¶ä¸Šä¼ çš„åŸºæœ¬å®ç°æ€è·¯ã€‚
##### 1ã€å…¨å±€çš„æ€è€ƒ
é¦–å…ˆå¾—æœ‰ä¸€ä¸ªå¤§å±€çš„åˆ¤æ–­ï¼Œéœ€è¦ç”¨åˆ°ä»€ä¹ˆæŠ€æœ¯ï¼Œéœ€è¦å®ç°å“ªäº›åŠŸèƒ½ï¼Œç„¶åå†å†™ä»£ç ï¼Œè™½ç„¶æˆ‘å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½ä¸æ˜¯è¿™æ ·çš„ğŸ˜‚ï¼ˆçº¯é æ„Ÿè§‰ğŸ‘ï¼‰ï¼Œå› ä¸ºä»æ¥æ²¡åšè¿‡å˜›ï¼Œæˆ‘ä¸€èˆ¬éƒ½æ˜¯ç™¾åº¦ï¼ŒCSDN æ‰¾æ‰¾ï¼Œæ˜é‡‘ä¸Šæ‰¾æ‰¾æ–‡ç« ï¼Œç«™åœ¨å·¨äººçš„è‚©è†€ä¸ŠçœŸçš„å¾ˆå¦™å“‡~

æ–‡ç« æœ€åç»™å‡ºäº†å‡ ç¯‡æˆ‘å‚è€ƒçš„æ–‡ç« ã€‚

æ—¢ç„¶åšå‡ºæ¥äº†å°±å¯ä»¥è¯´ä¸€ä¸‹è¦å®ç°æ–‡ä»¶ä¸Šä¼ çš„åŸºæœ¬æ­¥éª¤æœ‰å“ªäº›äº†ï¼š

1. ç¡®å®šä½ è¦å®ç°çš„æ˜¯å¤§æ–‡ä»¶ä¸Šä¼ ï¼Œè¿˜æ˜¯å°æ–‡ä»¶ä¸Šä¼ ï¼Œåƒ 20 M ä»¥ä¸‹éƒ½ç®—æ¯”è¾ƒå°çš„æ–‡ä»¶ï¼ŒåŸºæœ¬å¯ä»¥é‡‡ç”¨å•ä¸ªè¯·æ±‚æ¥å‘é€æ•´ä¸ªæ–‡ä»¶ï¼Œå¦‚æœå¤±è´¥é‡è¯•å³å¯ã€‚

2. ä¸Šä¼ å¤§æ–‡ä»¶ç”±äºç”¨æˆ·ç½‘ç»œçš„ä¸ç¡®å®šæ€§ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘å°†æ–‡ä»¶è¿›è¡Œ`åˆ†ç‰‡å¤„ç†`ï¼Œå¦å¤–å‘é€å¤šä¸ªè¯·æ±‚ä½¿ç”¨åˆ°äº†å¤šçº¿ç¨‹ï¼Œèƒ½å¤§å¤§æé«˜ä¸Šä¼ çš„æ•ˆç‡ã€‚

3. ä½¿ç”¨åˆ°åˆ†ç‰‡åï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡ç«¯å°†è¿™äº›`åˆ†ç‰‡æ–‡ä»¶åˆå¹¶`æˆä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶ï¼Œç”±äºæˆ‘ä»¬ä¸èƒ½ä¿è¯åˆ†ç‰‡ä¸Šä¼ çš„æœ‰åºæ€§ï¼Œæ‰€ä»¥éœ€è¦ç»™æ¯ä¸ªåˆ†ç‰‡è®¾ç½®ä¸€ä¸ª`å”¯ä¸€æ ‡è¯†`ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨åˆ†ç‰‡çš„ hash å€¼ä½œä¸ºåˆ†ç‰‡çš„å”¯ä¸€æ ‡è¯†ã€‚ï¼ˆæˆ‘ä½¿ç”¨çš„æ˜¯æ¯ä¸ªåˆ†ç‰‡åœ¨æ–‡ä»¶ä¸­çš„ç´¢å¼•ï¼Œè¿™ä¸ªè¦æ–¹ä¾¿ä¸€äº›ï¼Œä½†å®‰å…¨æ€§è¦æ›´å·®ï¼Œä¹ŸéªŒè¯ä¸äº†æ–‡ä»¶çš„å®Œæ•´æ€§ï¼‰

4. åˆ†ç‰‡æ–‡ä»¶çš„ä¸Šä¼ å°±å¼•å‡ºäº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼ˆè§£å†³é—®é¢˜ä¼šäº§ç”Ÿé—®é¢˜ğŸ˜‚ï¼‰ï¼ŒåŒæ—¶ä¸Šä¼ è¿™äº›åˆ†ç‰‡ä¼šå¯¼è‡´å®¢æˆ·ç«¯å¡é¡¿ï¼Œä¹Ÿä¼šæ¶ˆè€—æœåŠ¡ç«¯çš„çº¿ç¨‹èµ„æºã€‚å¦‚æœæ–‡ä»¶éå¸¸å¤§ï¼Œä¸Šä¼ æ—¶é—´éå¸¸é•¿ï¼Œä¼šå¯¼è‡´`æµè§ˆå™¨å¡é¡¿ç”šè‡³æœªå“åº”`ï¼Œå¯¹æœåŠ¡ç«¯ä¹Ÿä¼šé€ æˆå‹åŠ›ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª`è¯·æ±‚é˜Ÿåˆ—`ï¼Œé™åˆ¶æœ€å¤§è¯·æ±‚æ•°é‡ï¼Œè¾¾åˆ°æœ€å¤§çš„è¯·æ±‚ä»»åŠ¡æ•°é‡æ—¶ï¼Œå…¶ä»–çš„ä»»åŠ¡ç­‰å¾…æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ã€‚

5. ç”±äºå¤§æ–‡ä»¶ä¸Šä¼ ä½¿ç”¨åˆ†ç‰‡ä¸Šä¼ ï¼Œæ¯ä¸ªåˆ†ç‰‡çš„ä¸Šä¼ ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ç»™å®ƒä¸­æ–­ï¼Œæ‰€ä»¥è¿™é‡Œå°±å¯ä»¥è®¾ç½®ä¸€ä¸ª`æš‚åœ`çš„åŠŸèƒ½ï¼Œæ‰‹åŠ¨ä¸­æ–­è¯·æ±‚ï¼Œæ¸…ç©ºè¯·æ±‚é˜Ÿåˆ—ã€‚è¿™æ—¶å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½ä¿å­˜ç€ä¸Šä¼ è®°å½•ã€‚å®¢æˆ·ç«¯ç‚¹å‡»å¼€å§‹ä¸Šä¼ ï¼Œä¼šä»ä¸Šæ¬¡çš„ä¸Šä¼ ä½ç½®ç»§ç»­ä¸Šä¼ ã€‚

6. å½“æ‰€æœ‰æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ å®Œæˆåï¼Œé€šçŸ¥æœåŠ¡ç«¯`åˆå¹¶æ–‡ä»¶`ï¼Œæˆ–è€…åœ¨ä¸Šä¼ æ–‡ä»¶åˆ†ç‰‡å‰å‘Šè¯‰æœåŠ¡ç«¯æœ‰å¤šå°‘ä¸ªåˆ†ç‰‡ï¼Œè®©æœåŠ¡ç«¯åœ¨æ‰€æœ‰åˆ†ç‰‡ä¸Šä¼ ä¹‹åè‡ªåŠ¨åˆå¹¶æ–‡ä»¶ã€‚åˆå¹¶ååˆ é™¤æ‰€æœ‰åˆ†ç‰‡æ–‡ä»¶ã€‚

å¤§ä½“çš„æ–‡ä»¶ä¸Šä¼ çš„æ€è·¯å°±æ˜¯ä¸Šè¿°è¿™äº›ï¼Œå½“ç„¶ä½ å¯ä»¥å¢åŠ æ›´å¤šçš„åŠŸèƒ½ã€‚

##### 2ã€éƒ¨åˆ†ä»£ç è§£æ
æºä»£ç ä¸‹è½½åœ°å€è§æ–‡æœ«ã€‚

ä¸‹é¢åªåˆ—å‡ºäº†æˆ‘è§‰å¾—æ¯”è¾ƒé‡è¦çš„ä»£ç ç‰‡æ®µï¼Œå…¶ä»–çš„éƒ¨åˆ†è¯·æŸ¥çœ‹æºä»£ç ï¼ˆæºä»£ç ä¸­ç»™å‡ºäº†å¿…è¦çš„è§£é‡Šï¼Œè§£é‡Šä¸å¥½çš„åœ°æ–¹è¿˜è¯·è§è°…ï¼ï¼‰ã€‚

###### a. å°†æ–‡ä»¶è¿›è¡Œåˆ†ç‰‡å¤„ç†
æ–‡ä»¶åˆ†ç‰‡ä½¿ç”¨ `Blob.prototype.slice()` æ¥å¤„ç†ï¼Œ`Blob` æ˜¯ `File` çš„çˆ¶ç±»ï¼ˆè¶…ç±»ï¼‰ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ `slice` æ–¹æ³•ï¼Œå…³äº Blob çš„è¯¦æƒ…è¯·æŸ¥çœ‹ [MDN â€”â€” Blob Web API](https://developer.mozilla.org/zh-CN/docs/Web/API/Blob)ã€‚

æˆ‘æ˜¯ä½¿ç”¨æ–‡ä»¶åˆ†ç‰‡åœ¨æ–‡ä»¶ä¸­çš„ç´¢å¼•ä½œä¸ºåˆ†ç‰‡çš„å”¯ä¸€æ ‡è¯†çš„ã€‚ä¸‹å›¾ä¸­çš„æ–¹å—å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶åˆ†å—ã€‚å…¶ä¸­çš„æ•°å­—å°±æ˜¯å®ƒçš„ç´¢å¼•ã€‚ä½¿ç”¨ hash å€¼ä½œä¸ºå”¯ä¸€ç´¢å¼•ï¼Œå¦‚æœåœ¨å®¢æˆ·ç«¯è®¡ç®—å¯ä»¥ä½¿ç”¨ [spark-md5](https://www.npmjs.com/package/spark-md5) æ¥è®¡ç®— hashï¼Œä½¿ç”¨çš„æ˜¯ MD5 ç®—æ³•ã€‚

![chunk_index.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/de8057b982334d3ab69b58ba8f8a7b98~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=853&h=263&s=3180&e=png&a=1&b=ffffff)

ä¸‹é¢çš„ä»£ç æ˜¯å°†ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œåˆ†ç‰‡å¤„ç†ã€‚

```js
/**
 * å°†æ–‡ä»¶åˆ†ç‰‡å¤„ç†, æ ¹æ®æ˜¯å¦æœåŠ¡ç«¯ç»™çš„åˆ†ç‰‡ç´¢å¼•, ä»¥åŠå–æ¶ˆä¸Šä¼ çš„åˆ†ç‰‡ç´¢å¼•è·å–è¿˜æœªä¸Šä¼ çš„åˆ†ç‰‡ç´¢å¼•
 * @param file {File} è¦åˆ†ç‰‡çš„æ–‡ä»¶
 * @param chunkIndex {[number]} æœåŠ¡ç«¯ç»™çš„å·²ä¸Šä¼ çš„åˆ†ç‰‡ç´¢å¼•æ•°ç»„
 * @return {[{file: File, index: number}]} è¿”å›å¯¹è±¡æ•°ç»„, å¯¹è±¡ä¸­åŒ…æ‹¬åˆ†ç‰‡åçš„ Blob ä»¥åŠè¯¥åˆ†ç‰‡åœ¨æ–‡ä»¶ä¸­çš„ä½ç½®, ä¹Ÿå°±æ˜¯ç´¢å¼•
 */
createChunk(file, chunkIndex) {
    const chunkArr = [];
    const size = file.size;
    let start = 0;
    // åˆ†ç‰‡çš„ç´¢å¼•
    let index = 0;
    // cancelChunkIndex æ˜¯å–æ¶ˆä¸Šä¼ çš„åˆ†ç‰‡çš„ç´¢å¼•æ•°ç»„, åœ¨æš‚åœæ—¶å–æ¶ˆçš„è¯·æ±‚, å…¶ä»£è¡¨çš„åˆ†ç‰‡ç´¢å¼•ä¼šå­˜åœ¨å…¶ä¸­, ä¸‹æ¬¡é‡ä¼ 
    // å¦‚æœæœåŠ¡ç«¯æœ‰è¿™ä¸ªç´¢å¼•, åˆ™å°†å…¶è¿‡æ»¤æ‰
    chunkIndex = chunkIndex.filter((item) => !this.cancelChunkIndex.includes(item));
    this.cancelChunkIndex = [];
    while (start < size) {
        // å¦‚æœåˆ†ç‰‡å·²ç»ä¸Šä¼ , åˆ™è·³è¿‡
        if (chunkIndex.includes(index)) {
            start += chunkSize;
            index++;
            continue;
        }
        // chunkSize æ˜¯æ¯ä¸ªåˆ†ç‰‡çš„å¤§å°, ä»¥å­—èŠ‚ä¸ºå•ä½, æˆ‘è®¾ç½®çš„æ˜¯ 1M, 1<<20 å­—èŠ‚
        let end = start + chunkSize;
        // æ·»åŠ åˆ†ç‰‡
        chunkArr.push({
            file: file.slice(start, end),
            index,
        });
        start = end;
        index++;
    }
    return chunkArr;
}
```


###### b. è¯·æ±‚é˜Ÿåˆ—
è¯·æ±‚é˜Ÿåˆ—é™åˆ¶è¯·æ±‚çš„æ•°é‡ï¼Œä»»åŠ¡æ’é˜Ÿæ‰§è¡Œï¼Œè¿™ä¸ªè¯·æ±‚é˜Ÿåˆ—åŸºäº `Promise` å’Œ `é€’å½’` æ¥å®ç°ï¼Œä¸ä½¿ç”¨å¾ªç¯åˆ¤æ–­ï¼Œæ‰€ä»¥ä¸å½±å“ä¸»çº¿ç¨‹çš„æ‰§è¡Œã€‚å¹¶ä¸”è¯¥ä»»åŠ¡é˜Ÿåˆ—å…·æœ‰ä¸€å®šçš„é€šç”¨æ€§ï¼Œåªè¦ä»»åŠ¡ä»¥å‡½æ•°å½¢å¼ä¼ å…¥ï¼Œéƒ½èƒ½ä½¿ç”¨è¯¥é˜Ÿåˆ—ã€‚è‡ªä¸ªè®¤ä¸ºè¿™ä¸ªè¯·æ±‚é˜Ÿåˆ—æ˜¯æœ‰ä¸€å®šçš„å‚è€ƒä»·å€¼çš„ã€‚

æˆ‘ç”»äº†ä¸€å¼ å›¾ï¼Œä¸çŸ¥é“æ˜¯å¦èƒ½è§£é‡Šçš„äº†è¯·æ±‚é˜Ÿåˆ—çš„æ‰§è¡Œè¿‡ç¨‹ã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ceac541b921948d2b21375f56c39eac6~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=882&h=316&s=9927&e=png&b=ffffff)

æ³¨æ„ï¼šåœ¨æœªä½¿ç”¨é—­åŒ…çš„å‰æä¸‹ï¼Œåœ¨ Promise çš„ then æ–¹æ³•ä¸­ä½¿ç”¨é€’å½’ä¸ä¼šå¯¼è‡´æ ˆæº¢å‡ºï¼ˆä½†ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼‰ã€‚

```js
function ruc() {
    new Promise((resolve) => {
        resolve();
    }).then(() => {
        console.log("æŒç»­è¿è¡Œ...");
        // æœªä½¿ç”¨é—­åŒ…, ä¸ä¼šé€ æˆæ ˆæº¢å‡º
        // å› ä¸ºä¹‹å‰çš„çš„å‡½æ•°å·²ç»ä»æ ˆä¸­ç§»é™¤, è€Œ then çš„å‚æ•°ï¼ˆå‡½æ•°ï¼‰ä¼šåœ¨
        // promise å®ŒæˆååŠ å…¥åˆ°æµè§ˆå™¨çš„äº‹ä»¶é˜Ÿåˆ—ä¸­æ‰§è¡Œã€‚
        // ä½œç”¨åŸŸæ— åµŒå¥—, å¦‚æœä½¿ç”¨äº†é—­åŒ…æˆ‘å°±ä¸å¾—è€ŒçŸ¥äº†
        ruc();
    });
}
ruc();
```

ç¨å¾®ä»‹ç»äº†ä¸€ä¸‹å…¶ä»–æ–¹é¢ï¼Œè¯·æ±‚é˜Ÿåˆ—çš„ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š

```js
/**
 * ä»»åŠ¡é˜Ÿåˆ—, å®ç°å•ä½æ—¶é—´å†…æ‰§è¡ŒæŒ‡å®šæœ€å¤§æ•°é‡çš„ä»»åŠ¡çš„æ‰§è¡Œ
 * å³åœ¨æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡æ‰§è¡Œå®Œæˆå‰, å…¶ä»–çš„ä»»åŠ¡å¿…é¡»ç­‰å¾…, å½“ç„¶æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡çš„æ•°é‡å¯ä»¥æŒ‡å®š
 */
class TaskQueue {

    /**
     * å‡½æ•°è¿”å›å€¼
     * @type {[*]}
     */
    result;
    /**
     * ä»»åŠ¡æ•°ç»„
     * @type {[function]}
     */
    taskList;
    /**
     * ç”¨ Promise åŒ…è£¹ä»»åŠ¡
     * @type {[Promise]}
     */
    taskPromiseArray;
    /**
     * ä»»åŠ¡æ‰§è¡Œçš„ç´¢å¼•
     * @type {number}
     */
    taskIndex;
    /**
     * æœ€å¤§å¹¶å‘æ•°
     * @type {number}
     */
    maximumConcurrency;
    /**
     * æ˜¯å¦è¿è¡Œç»“æŸ, è¿™ä¸ªå±æ€§çš„ä½œç”¨æ˜¯é˜²æ­¢å¤šæ¬¡æ‰§è¡Œè¿è¡Œç»“æŸå›è°ƒ
     * @type {boolean}
     */
    runOver;
    /**
     * è¿è¡Œç»“æŸå›è°ƒ
     * @type {function}
     */
    runOverCallback;

    constructor(maximumConcurrency = 2) {
        this.maximumConcurrency = maximumConcurrency;
        this.setRunOver(true);
        this.initial();
    }

    /**
     * æ·»åŠ ä»»åŠ¡, ä»»åŠ¡æ˜¯å‡½æ•°å½¢å¼
     * @param task {function} ä»»åŠ¡, å‡½æ•°
     */
    addTask(...task) {
        this.taskList.push(...task);
    }

    /**
     * è¿è¡Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡, è¿è¡Œç»“æŸåé‡ç½®æ‰§è¡Œé˜Ÿåˆ—
     * @param args æ¯ä¸ªä»»åŠ¡è¦æ‰§è¡Œæ—¶éœ€è¦çš„å‚æ•°, å¯å˜å‚æ•°
     */
    run(...args) {
        this.setRunOver(false);
        let maximumConcurrency = Math.min(this.maximumConcurrency, this.taskList.length);
        for (let index = 0; index < maximumConcurrency; index++) {
            this.executeSingleTask(args);
        }
    }

    /**
     * æ¯ä¸ªè¯·æ±‚ç»“æŸåéƒ½ä¼šåˆ¤æ–­æ˜¯å¦æ‰§è¡Œç»“æŸ
     * @param args æ¯ä¸ªä»»åŠ¡è¦æ‰§è¡Œæ—¶éœ€è¦çš„å‚æ•°, å¯å˜å‚æ•°
     */
    judgeExecuteEnd(args) {
        let taskList = this.taskList;
        let taskPromiseArray = this.taskPromiseArray;
        // å½“æ‰€æœ‰çš„ä»»åŠ¡éƒ½å¾—åˆ°æ‰§è¡Œ, ä½†éƒ¨åˆ†ä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæ¯•
        // è¿™é‡Œ !this.getRunOver() å¯ä»¥æ›¿æ¢ä¸º this.taskList.length === 0
        // è¿™æ˜¯ç”±äºæ‰§è¡Œäº† initial()
        if (this.taskIndex >= taskList.length && !this.getRunOver()) {
            this.setRunOver(true);
            let result = this.getResult();
            // ç­‰å¾…æ‰€æœ‰çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åæ‰§è¡Œå›è°ƒ
            Promise.all(taskPromiseArray).then(() => {
                this.runOverCallback && this.runOverCallback(result);
            });
            this.initial();
            return;
        }
        // å¦‚æœè¿˜æœ‰ä»»åŠ¡åˆ™ç»§ç»­æ‰§è¡Œ
        this.executeSingleTask(args);
    }

    /**
     * æ‰§è¡Œä¸€ä¸ªä»»åŠ¡
     * @param args æ¯ä¸ªä»»åŠ¡è¦æ‰§è¡Œæ—¶éœ€è¦çš„å‚æ•°, å¯å˜å‚æ•°
     */
    executeSingleTask(args) {
        let taskList = this.taskList;
        let taskPromiseArray = this.taskPromiseArray;
        let promise = new Promise((resolve, reject) => {
            // æ‰§è¡Œä»»åŠ¡å¹¶å°†è¿”å›å€¼ä¿å­˜
            this.result.push(taskList[this.taskIndex++](resolve, reject, ...args));
        }).then(() => {
            this.judgeExecuteEnd(args);
        }).catch(() => {
            this.initial();
        });
        taskPromiseArray.push(promise);
    }

    getResult() {
        return this.result;
    }

    /**
     * è®¾ç½®ä»»åŠ¡æ‰§è¡Œå®Œæˆå›è°ƒ
     * @param callback å›è°ƒå‡½æ•°
     */
    setRunOverCallback(callback) {
        this.runOverCallback = callback;
    }

    getRunOver() {
        return this.runOver;
    }

    setRunOver(runOver) {
        this.runOver = runOver;
    }

    initial() {
        this.result = [];
        this.taskList = [];
        this.taskPromiseArray = [];
        this.taskIndex = 0;
    }
}
```

###### c. ç®€å•å°è£… XMLHttpRequest
å°è£… XMLHttpRequest ä¸»è¦æ˜¯ä¸ºäº†å‡å°‘é‡å¤ä»£ç çš„ç¼–å†™, è¿™é‡Œç®€å•å¯¹å…¶è¿›è¡Œäº†å°è£…ï¼Œè¿™ä¸ªå°è£…ä»£ç è€ƒè™‘åˆ°çš„åœ°æ–¹è¿˜æ˜¯ä¸å……åˆ†çš„ã€‚å¦‚æœè¦å‘é€è¯·æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ [alova](https://alova.js.org/zh-CN/)ï¼ˆå·ç§°å–ä»£ axiosï¼‰ï¼Œæˆ–è€…ä½¿ç”¨ [axios](http://www.axios-js.com/)ã€‚

```js
/**
 * è¯·æ±‚å°è£…
 */
request({url, method = "get", params, data, progressHandler, abortHandler}) {
    return new Promise((resolve, reject) => {
        let xh = new XMLHttpRequest();
        let paramArr = [];
        // æ”¶é›† params
        for (let key in params) {
            if (Object.prototype.hasOwnProperty.call(params, key)) {
                paramArr.push(`${key}=${params[key]}`);
            }
        }
        if (paramArr.length !== 0) {
            url += `?${paramArr.join("&")}`;
        }
        xh.open(method, url);
        // æ”¶é›† data
        let formData = new FormData();
        for (let key in data) {
            if (Object.prototype.hasOwnProperty.call(data, key)) {
                formData.append(key, data[key]);
            }
        }
        // ä¸Šä¼ å®Œæˆ
        xh.onload = (e) => {
            resolve(JSON.parse(xh.responseText));
        };
        // äº§ç”Ÿé”™è¯¯
        xh.onerror = (e) => {
            reject(e);
        };
        // è¯·æ±‚ç›‘æ§
        xh.upload.onprogress = (e) => {
            progressHandler && progressHandler(e);
        };
        // ä¸­æ–­è¯·æ±‚
        xh.onabort = (e) => {
            reject(e);
        };
        // è¯·æ±‚ç»ˆæ­¢å¤„ç†
        abortHandler && abortHandler(() => {
            xh.abort();
        });
        // cookie è·¨åŸŸ
        xh.withCredentials = true;
        xh.send(formData);
    });
}
```




###### d. ä¸Šä¼ æ–‡ä»¶åˆ†ç‰‡
åŸºäºä¸Šè¿°å®ç°ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å®ç°å…·æœ‰åŸºæœ¬åŠŸèƒ½çš„æ–‡ä»¶ä¸Šä¼ äº†ã€‚

æˆ‘å°†æ–‡ä»¶çš„ä¸Šä¼ åˆ†ä¸ºäº†ä¸‰ä¸ªé˜¶æ®µï¼ˆè¿™é‡Œå‚è€ƒäº†å“”å“©å“”å“©çš„æŠ•ç¨¿ä¸Šä¼ ï¼‰ï¼Œåˆ†åˆ«è®¾ç½®äº†ä¸Šä¼ å‰ï¼Œä¸Šä¼ ä¸­ï¼Œä¸Šä¼ å®Œæˆä¸‰ä¸ªè¯·æ±‚é˜¶æ®µï¼š

- ä¸Šä¼ å‰ï¼šè¿™ä¸ªé˜¶æ®µä¸»è¦å¯¹æ–‡ä»¶è¿›è¡Œ`é¢„è§£æ`ï¼ŒæœåŠ¡ç«¯æ ¹æ®æ–‡ä»¶çš„å¤§å°è®¾ç½®æ¯ä¸ªåˆ†ç‰‡çš„å¤§å°ï¼ˆå½“ç„¶ç½‘ç»œä¹Ÿæ˜¯è¦è€ƒè™‘çš„æ–¹é¢ï¼‰ï¼Œç„¶åæœåŠ¡ç«¯ä¼šç»™è¿™ä¸ªæ–‡ä»¶å®šä¸‹ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ï¼Œå®¢æˆ·ç«¯ä¸Šä¼ æ—¶æºå¸¦è¿™ä¸ªå”¯ä¸€æ ‡è¯†å°±èƒ½ç¡®å®šå®¢æˆ·ç«¯ä¸Šä¼ çš„æ˜¯å“ªä¸ªæ–‡ä»¶äº†ã€‚

- ä¸Šä¼ ä¸­ï¼šè¿™ä¸ªé˜¶æ®µä¸»è¦ä»»åŠ¡æ˜¯ä¸Šä¼ æ¯ä¸ªåˆ†ç‰‡ï¼Œè¿™æ—¶å¯ä»¥`ç›‘æ§æ¯ä¸ªåˆ†ç‰‡çš„ä¸Šä¼ è¿›åº¦`ï¼Œé€šè¿‡ä¸‹é¢çš„ uploadFile() ä¸­çš„æŸç§è®¡ç®—æ–¹æ³•ï¼Œå¯ä»¥ç›‘æ§æ–‡ä»¶ä¸Šä¼ çš„æ€»è¿›åº¦ï¼Œä¿å­˜ä¹‹å‰çš„ä¸Šä¼ è¿›åº¦ï¼Œå¯ä»¥é¿å…å‡ºç°è¿›åº¦æ¡çš„å›é€€ã€‚è¿™ä¸ªé˜¶æ®µä¸­æ–­è¯·æ±‚å³å¯å®ç°ä¸Šä¼ çš„æš‚åœï¼Œå–æ¶ˆä¸Šä¼ ä¸æš‚åœç±»ä¼¼ï¼Œåªæ˜¯é¡µé¢å˜åŒ–äº†ï¼Œå¹¶é€šçŸ¥æœåŠ¡ç«¯è¿™ä¸ªæ–‡ä»¶åº”è¯¥åˆ é™¤ã€‚

- ä¸Šä¼ å®Œæˆï¼šè¿™ä¸ªé˜¶æ®µæ‰€æœ‰çš„åˆ†ç‰‡éƒ½å·²ç»ä¸Šä¼ å®Œæ¯•ï¼Œå®¢æˆ·ç«¯è¿™æ—¶æºå¸¦å¿…è¦çš„å‚æ•°å¹¶å‘é€ä¸€ä¸ªæ–‡ä»¶åˆå¹¶çš„è¯·æ±‚ï¼ŒæœåŠ¡ç«¯å°±ä¼šå¼€å§‹è¿›è¡Œæ–‡ä»¶çš„åˆå¹¶ï¼Œåˆå¹¶å®Œæˆé€šçŸ¥å®¢æˆ·ç«¯ä¸Šä¼ æˆåŠŸã€‚å®¢æˆ·ç«¯å¯ä»¥ç»§ç»­ä¸Šä¼ ä»–æ–‡ä»¶ã€‚

ä¸»è¦çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

```js
/**
 * ä¸Šä¼ å‰, é¢„çƒ­
 * @param file {File} è¦ä¸Šä¼ çš„æ–‡ä»¶
 */
preUpload(file)
{
    this.request({
        url: PRE_UPLOAD_URL,
        params: {
            filename: file.name,
            size: file.size,
        },
    }).then((response) => {
        // filename æ˜¯æœåŠ¡ç«¯ç»™æ–‡ä»¶çš„æ ‡è¯†, size æ˜¯ä¸€ä¸ªåˆ†ç‰‡çš„å¤§å°(å­—èŠ‚), chunkIndex æ˜¯å·²ç»ä¸Šä¼ çš„åˆ†ç‰‡ç´¢å¼•æ•°ç»„
        let {filename, size, chunkIndex} = response.data;
        this.filename = filename;
        chunkSize = size;
        this.uploadFile(file, chunkIndex);
    }).catch((error) => {
        console.log(error);
    });
}

/**
 * ä¸Šä¼ æ–‡ä»¶, å®ç°æ–­ç‚¹ç»­ä¼ , å¯æš‚åœ
 * @param file {File} è¦ä¸Šä¼ çš„æ–‡ä»¶
 * @param chunkIndex {[number]} æœåŠ¡å™¨ç»™çš„æœªä¸Šä¼ çš„åˆ†ç‰‡ç´¢å¼•
 */
uploadFile(file, chunkIndex)
{
    let chunkArr = this.createChunk(file, chunkIndex);
    this.changeDragBoard(UPLOADING);
    let filename = this.filename;
    let itemArr = new Array(chunkArr.length);
    let chunkArrLength = chunkArr.length;
    let requestArray = this.requestArray;

    chunkArr.forEach((item, index) => {
        // æ·»åŠ ä»»åŠ¡
        this.taskQueue.addTask((resolve, reject) => {
            let size = item.file.size;
            let chunkIndex = item.index;
            let requestItem;
            this.request({
                url: UPLOADING_URL,
                method: "post",
                params: {
                    index: chunkIndex,
                    name: filename,
                    size,
                },
                data: {
                    file: chunkArr[index].file,
                },
                progressHandler: (e) => {
                    // æ¯ä¸ªåˆ†ç‰‡çš„ä¸Šä¼ è¿›åº¦
                    itemArr[index] = e.loaded / e.total * 100;
                    // åˆ†ç‰‡è¿›åº¦ä¹‹å’Œ (å¯èƒ½å¤§äº 100, æ­£å¸¸)
                    let sum = itemArr.reduce((pre, cur) => pre + cur, 0);
                    // è®¡ç®—æ€»è¿›åº¦, å¦‚æœä¹‹å‰æš‚åœè¿‡, preProgress ä¸ä¸º 0, sum / chunkArrLength ä¼šè¾¾åˆ°ç™¾åˆ†ä¹‹ä¸€ç™¾
                    // å¦‚æœæš‚åœè¿‡, éœ€è¦è®¡ç®—æœªä¸Šä¼ çš„éƒ¨åˆ†çš„è¿›åº¦, è¿™å°±æ˜¯ remainProgressPercent çš„ä½œç”¨
                    // remainProgressPercent æŒ‡çš„æ˜¯æœªä¸Šä¼ çš„éƒ¨åˆ†ä¸æ‰€æœ‰æ–‡ä»¶çš„å æ¯”ï¼ˆå°æ•°å½¢å¼ï¼‰
                    // preProgress æ˜¯ä¹‹å‰ä¸Šä¼ çš„ç™¾åˆ†æ¯”
                    let progress = (sum / chunkArrLength * this.remainProgressPercent) + this.preProgress;
                    this.progress = progress;
                    this.setProgress(progress);
                },
                abortHandler(abort) {
                    requestItem = {abort, index: chunkIndex};
                    requestArray.push(requestItem);
                }
            }).then(() => {
                resolve();
                // è¯·æ±‚å®Œæˆååˆ é™¤è¯·æ±‚æ•°ç»„ä¸­çš„å¯¹è±¡
                requestArray.splice(requestArray.indexOf(requestItem), 1);
            }).catch(() => {
                // è¯·æ±‚ä¸­æ–­
                reject();
            });
        });
    });
    // æ·»åŠ ä¸Šä¼ å®Œæˆå›è°ƒ
    this.taskQueue.setRunOverCallback(() => {
        this.doms.uploadProgressContainer.classList.add(WAIT_MERGE);
        this.uploaded(filename);
    });
    this.taskQueue.run();
}

/**
 * ä¸Šä¼ å®Œæˆ, è¯·æ±‚æœåŠ¡å™¨åˆå¹¶åˆ†ç‰‡
 */
uploaded()
{
    let filename = this.filename;
    this.request({
        url: MERGE_URL,
        params: {
            name: filename
        }
    }).then(() => {
        this.changeDragBoard(UPLOADED);
        this.reset();
    }).catch((error) => {
        console.log(error);
    });
}
```

###### e. æš‚åœå’Œç»§ç»­ä¸Šä¼ 
ç”±äºè¿™ä¸ªéƒ¨åˆ†æ˜¯åŸºäºåˆ†ç‰‡ä¸Šä¼ çš„ï¼Œæš‚åœå°±æ˜¯ä¸­æ–­ä¸€ä¸‹è¯·æ±‚ï¼Œæ¸…ç©ºå…¶ä»–è¯·æ±‚ï¼Œç›¸å¯¹æ¥è¯´æ¯”è¾ƒç®€å•ã€‚ä¸è¿‡éœ€è¦è®°å½•ä¸€ä¸‹è¢«ä¸­æ–­çš„è¯·æ±‚ï¼Œä¸‹æ¬¡ä¸Šä¼ æ—¶éœ€è¦é‡æ–°è¯·æ±‚ã€‚è¿™é‡Œå°±ä¸é™„ä¸Šæºç äº†ï¼Œç®€å•è¯´ä¸€ä¸‹å®ç°åŸç†ã€‚

```js
/**
 * å®ç°æš‚åœä¸»è¦æ˜¯å€ŸåŠ© XMLHttpRequest æä¾›çš„ abort() æ–¹æ³•ï¼Œåœ¨è¯·æ±‚æœªå®Œæˆå‘é€å‰
 * å°†å…¶ä¸­æ–­ï¼Œè¿™æ—¶ä¼šè§¦å‘ä¸­æ–­å›è°ƒï¼Œéœ€è¦ç›‘å¬ï¼Œä¸­æ–­åæ¸…ç©ºè¯·æ±‚é˜Ÿåˆ—, åœæ­¢å‘é€è¯·æ±‚ã€‚
 */
 let xh = new XMLHttpRequest();
 xh.onabort = () => {};
 ...
 xh.abort();
 
 
 /**
  * å®ç°å¼€å§‹ä¸Šä¼ ä¸åˆšå¼€å§‹ä¸Šä¼ æ—¶æ˜¯ä¸€æ ·çš„ï¼Œè¿˜æ˜¯è¿›è¡Œäº†é‚£ä¸‰ä¸ªä¸Šä¼ é˜¶æ®µï¼Œåªæ˜¯åœ¨
  * preUpload æ—¶æœåŠ¡ç«¯ä¼šå‘Šè¯‰å®¢æˆ·ç«¯å“ªäº›åˆ†ç‰‡å·²ç»ä¸Šä¼ äº†ï¼Œå®¢æˆ·ç«¯åªéœ€è¦ä¸Šä¼ æœªä¸Š
  * ä¼ çš„åˆ†ç‰‡å³å¯ã€‚è¿™é‡Œæˆ‘æ˜¯ä½¿ç”¨åˆ†ç‰‡çš„ç´¢å¼•ç¡®å®šå…¶å”¯ä¸€æ€§ï¼Œå½“ç„¶ä½ å¯ä»¥ä½¿ç”¨ hashã€‚
  * è¿™ä¸‰ä¸ªé˜¶æ®µå±‚å±‚é€’è¿›ï¼Œä¸Šä¸€ä¸ªé˜¶æ®µç»“æŸæ‰ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªé˜¶æ®µã€‚
  */
  preload();
  uploadFile();
  uploaded();
```

###### d. æœåŠ¡ç«¯å¤„ç†
è¿™é‡Œæˆ‘ç”¨çš„æœåŠ¡ç«¯è¯­è¨€æ˜¯ Javaï¼Œå¯èƒ½æœ‰äººæ˜¯æ²¡å­¦è¿‡çš„ï¼Œä½†ä¼šç”¨ `node.js`ï¼Œè¿™ä¸ªä¼šçš„è¯é‚£ä¹Ÿå¥½åŠï¼Œå‰ç«¯å¯ä»¥å‚è€ƒä¸€ä¸‹æœ¬æ–‡ç« ï¼Œä½ å¯ä»¥åšä½ å–œæ¬¢çš„ä¿®æ”¹ï¼Œå¢åŠ ä½ æƒ³è¦çš„åŠŸèƒ½ã€‚æœåŠ¡ç«¯ä¹Ÿæ²¡ä»€ä¹ˆæ™¦æ¶©éš¾æ‡‚çš„ä»£ç ï¼Œå°±æ˜¯ç®€å•æ¥å—äº†è¯·æ±‚ï¼Œå¤„ç†ä¸€ä¸‹æ–‡ä»¶ï¼Œåˆå¹¶å®Œæˆå°†åˆ†ç‰‡åˆ é™¤å³å¯ï¼ˆä¸Šä¼ å‡ºé”™æˆ–è€…æµè§ˆå™¨åˆ·æ–°éœ€è¦é‡å¯æœåŠ¡å™¨ï¼Œå› ä¸ºå®¢æˆ·ç«¯åˆ·æ–°åä¹‹å‰çš„ä¸Šä¼ è®°å½•ä¼šæ¶ˆå¤±ï¼ŒæœåŠ¡ç«¯å´ä¿å­˜ç€ï¼Œä¼šå‡ºé”™ï¼‰ã€‚

è¿™é‡Œç²—ç•¥è¯´ä¸€ä¸‹ç”¨ Java å†™æœåŠ¡ç«¯ï¼ˆæºä»£ç å¯ä»¥åœ¨æ–‡ç« æœ«å°¾æ‰¾åˆ°ï¼‰ã€‚

è¿™é‡Œæˆ‘ä½¿ç”¨äº† SpringBoot æ¥å¤„ç†è¯·æ±‚ï¼Œä¸»è¦æ˜¯å›¾æ–¹ä¾¿ï¼ˆå› ä¸ºçœŸçš„å¾ˆæ–¹ä¾¿ï¼‰ã€‚

ä¸‹é¢æ˜¯è¿›è¡Œæ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ çš„ä»£ç ï¼š

```java
/**
 * å­˜åœ¨çš„é—®é¢˜ï¼šå¯èƒ½ä¼šæŠ›å‡º java.io.EOFExceptionï¼Œè¡¨ç¤ºè¯»å–åˆ°æ–‡ä»¶çš„æœ«å°¾ï¼Œå½“å®¢æˆ·ç«¯
 * ä¸­æ–­è¯·æ±‚æ—¶å¯èƒ½ä¼šå‘ç”Ÿï¼Œè¿™ä¸ªé”™è¯¯æ˜¯ SpringBoot å†…åµŒçš„ Tomcat æŠ›å‡ºçš„ï¼Œ
 * å±€éƒ¨å¼‚å¸¸æ•è·å™¨å¹¶ä¸èƒ½æ•è·ï¼Œå…¨å±€çš„æ•è·å™¨ä¿®æ”¹è¿™ä¸ªç±»çš„å†…éƒ¨å˜é‡åˆæ¯”è¾ƒéº»çƒ¦ï¼Œ
 * æ‰€ä»¥ä¸­æ–­çš„è¯·æ±‚å¯¹åº”çš„åˆ†ç‰‡ç´¢å¼•åœ¨æœåŠ¡ç«¯ä¼šå­˜åœ¨ï¼Œæ‰€ä»¥éœ€è¦å®¢æˆ·ç«¯è®°å½•ä¸€ä¸‹
 */

@PostMapping("/upload")
public Result<?> upload(@RequestParam("file") MultipartFile file, Integer index, Integer size, String name) throws IOException {
    Result<?> result = this.checkFilename(name);
    if (!result.success()) {
        return Result.error();
    }
    // åˆ¤æ–­å½“å‰ç´¢å¼•å¯¹åº”çš„åˆ†ç‰‡æ˜¯å¦å­˜åœ¨
    if (this.fileHash[index] != null) {
        return Result.error();
    }
    // ä»¥ç´¢å¼•ä½œä¸ºåˆ†ç‰‡å, å¦‚ç´¢å¼•ä¸º 1 åˆ™æ–‡ä»¶åä¸º 1
    File chunk = new File(this.dir, index + "");
    chunk.createNewFile();
    // è·å–è¯¥åˆ†ç‰‡çš„æ–‡ä»¶ hash, åˆ†ç‰‡çš„ hash å¯ä»¥åšæ–‡ä»¶ç§’ä¼ 
    String md5 = SecureUtil.md5(chunk);
    fileHash[index] = md5;

    file.transferTo(chunk);
    return Result.ok(null);
}
```

ä¸‹é¢æ˜¯åˆå¹¶æ–‡ä»¶åˆ†ç‰‡çš„ä»£ç ï¼š

```java
/**
 * æ–‡ä»¶åˆå¹¶æ˜¯å°†å¤šä¸ªæ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªæ–‡ä»¶ã€‚
 * è¿™é‡Œæˆ‘ä½¿ç”¨äº† RandomAccessFile éšæœºè¯»å†™ï¼Œé€šè¿‡ seek() è®¾ç½®å…¶æ–‡ä»¶æŒ‡é’ˆ
 * æ–‡ä»¶ä¸Šä¼ å‡ ä¹æ˜¯æ¨¡ç‰ˆå¼çš„ä»£ç ï¼Œè¿™é‡Œå°±ä¸è§£é‡Šäº†
 */

@GetMapping("/uploaded")
public Result<?> uploaded(String name) throws IOException {
    Result<?> result = this.checkFilename(name);
    if (!result.success()) {
        return Result.error();
    }
    File[] files = this.dir.listFiles();
    RandomAccessFile writeFile = new RandomAccessFile(new File("B:/" + this.resultFileName + this.suffix), "rw");
    RandomAccessFile readFile;
    byte[] bytes = new byte[this.bufferLength];
    for (File file : files) {
        int pos = this.CHUNK_SIZE * Integer.parseInt(file.getName());
        writeFile.seek(pos);
        readFile = new RandomAccessFile(file, "r");
        while (readFile.read(bytes) != -1) {
            writeFile.write(bytes);
        }
        readFile.close();
    }
    writeFile.close();
    for (File file : files) {
        file.delete();
    }
    this.reset();
    return Result.ok(null);
}
```

#### äº”ã€é¡¹ç›®è®¨è®º
ç”±äºä¸ªäººè€ƒè™‘ä¸å‘¨ï¼Œå¦‚æœæœ‰åœ°æ–¹å®ç°çš„è®©å®¢å®˜æ‚¨ä¸æ»¡æ„ï¼Œæ¯”å¦‚å¦‚æœæœ‰ä»£ç å†—ä½™ï¼Œè®¾è®¡ä¸å¥½çš„åœ°æ–¹ï¼Œè¯·åœ¨è¯„è®ºåŒºç•™è¨€~~~

##### 1ã€æ–‡ä»¶ç§’ä¼ 
æ–‡ä»¶ç§’ä¼ æ˜¯éœ€è¦è€—è´¹æŒºå¤§çš„ç®—åŠ›çš„ï¼Œå¹¶ä¸”æ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦ä¿å­˜ä¹‹å‰çš„ä¸Šä¼ è¿‡çš„è®°å½•ã€‚æœåŠ¡ç«¯æˆ‘å¹¶æ²¡æœ‰ä½¿ç”¨ Mysqlï¼Œæˆ–è€… Redis ç­‰æ•°æ®åº“ï¼Œè‡ªå·±ç”¨ java.util.Map å®ç°å­˜å‚¨å°±æ¯”è¾ƒç¹çã€‚å°±æš‚æ—¶ä¸è€ƒè™‘äº†ã€‚é€šä¿—æ¥è®²å°±æ˜¯æ‡’~

##### 2ã€æœªè®¾ç½®æ–‡ä»¶ URI
è¿˜æœ‰ä¸€ä¸ªåœ°æ–¹å°±æ˜¯ä¸Šä¼ æ–‡ä»¶åï¼Œå¦‚ä½•è®¿é—®è¿™ä¸ªæ–‡ä»¶ã€‚æœåŠ¡ç«¯æˆ‘å¹¶æ²¡æœ‰è®¾ç½®æ–‡ä»¶çš„è®¿é—®è·¯å¾„ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯ä¸Šä¼ äº†æ–‡ä»¶æ—¶æ— æ³•é€šè¿‡ URI è®¿é—®åˆ°çš„ã€‚

##### 3ã€å…¶ä»–
å®¢æˆ·ç«¯é¡µé¢è®¾è®¡çš„ä¸æ˜¯å¾ˆå¥½çœ‹ï¼Œä¸»è¦è€ƒè™‘åˆ°çš„æ˜¯åŠŸèƒ½å®ç°ï¼Œæ‰€ä»¥å°±éšä¾¿åšäº†ä¸€ä¸ªç®€å•çš„ä¸Šä¼ é¡µé¢ã€‚

#### å…­ã€æºä»£ç åœ°å€
ä¸‹é¢ç»™å‡ºäº†å‡ ä¸ªå¯ä»¥ä¸‹è½½æºä»£ç çš„åœ°å€ï¼š

1. [GitHub â€”â€” æ–‡ä»¶ä¸Šä¼ ](https://github.com/flower0wine/myself_amuse/tree/main/upload_download_files/upload)

2. [Gitee â€”â€” æ–‡ä»¶ä¸Šä¼ ](https://gitee.com/flowerswine/myself_amuse/tree/main/upload_download_files/upload)

3. [CSDN â€”â€” å®¢æˆ·ç«¯æºä»£ç ](https://download.csdn.net/download/weixin_64433668/88595414)

4. [CSDN â€”â€” æœåŠ¡ç«¯æºä»£ç ](https://download.csdn.net/download/weixin_64433668/88595418)


#### ä¸ƒã€å‚è€ƒæ–‡çŒ®
å‚è€ƒçš„ä¸»è¦æ–‡ç« å¦‚ä¸‹æ‰€ç¤ºï¼š

[å­—èŠ‚è·³åŠ¨é¢è¯•å®˜ï¼šè¯·ä½ å®ç°ä¸€ä¸ªå¤§æ–‡ä»¶ä¸Šä¼ å’Œæ–­ç‚¹ç»­ä¼  - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/6844904046436843527)

[ã€JavaScriptã€‘æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ _jsåˆ†ç‰‡ä¸Šä¼ _ç­‰æ—¶é’Ÿæˆé•¿çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/pangji0417/article/details/130893530?spm=1001.2014.3001.5506)

[å­—èŠ‚è·³åŠ¨é¢è¯•å®˜ï¼Œæˆ‘ä¹Ÿå®ç°äº†å¤§æ–‡ä»¶ä¸Šä¼ å’Œæ–­ç‚¹ç»­ä¼  - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/6844904055819468808#heading-8)

æ­¤å¤–è¿˜æŸ¥é˜…äº†å…¶ä»–çš„æ–‡ç« ï¼Œå±äºç»†ææœ«èŠ‚ï¼Œå°±ä¸åˆ—å‡ºæ¥äº†ã€‚

#### å…«ã€æœ‰è¯è¯´
ä»£ç ä¸­å¦‚æœæœ‰ä»€ä¹ˆç‘•ç–µè®©å®¢å®˜æ‚¨ä¸æ»¡æ„ï¼Œå¯ä»¥åœ¨è¯„è®ºä¸­ç•™è¨€ã€‚å¦å¤–æœ¬äººæ°´å¹³ä¸é«˜ï¼Œè¡¨è¾¾èƒ½åŠ›è¾ƒå·®ï¼Œä»£ç ä¸­å¦‚æœæœ‰ bugï¼Œæœ‰ä»€ä¹ˆåœ°æ–¹æ²¡æœ‰è§£é‡Šæ˜ç™½è¿˜è¯·è°…è§£~ã€‚

æ„Ÿè°¢æ‚¨çš„æµè§ˆï¼ï¼ï¼
